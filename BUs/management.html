<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Rujum AI | Management</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,600;9..144,700&family=Inter:wght@400;500;600&family=Assistant:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="app">
        
        <app-header :lang="lang" @toggle-lang="toggleLang"></app-header>
        <ai-chat></ai-chat>

        <main class="content-wrap px-6 sm:px-8">

            <div class="flex justify-between items-end mb-8 sticky top-[90px] z-30 bg-[#FDFBF7]/95 py-4 backdrop-blur-sm">
                <div>
                    <h1 class="text-4xl font-serif text-slate-900 mb-1 leading-tight">{{ t('management') }}</h1>
                    <p class="text-slate-400 text-sm font-bold flex gap-1">
                        <span class="bidi-isolate">{{ sortedAssignedTasks.length }}</span> 
                        {{ t('activeTasks') }}
                    </p>
                </div>
            </div>

            <section-header :title="t('tasks')" icon="management.png" :has-action="true" @action="openCreateModal('task')"></section-header>

            <div v-if="unassignedTasks.length > 0" class="mb-8">
                <h4 class="text-xs font-black text-orange-400 uppercase tracking-widest mb-4 px-2 flex items-center gap-2">
                    <div class="w-2 h-2 rounded-full bg-orange-400 animate-pulse"></div>
                    {{ t('waitingForOwner') }}
                </h4>
                <div class="board-container">
                    <div class="board-grid">
                        <div class="board-header">
                            <div class="header-cell">{{ t('task') }}</div>
                            <div class="header-cell cell-center">{{ t('status') }}</div>
                            <div class="header-cell cell-center">{{ t('urgency') }}</div>
                            <div class="header-cell">{{ t('dueDate') }}</div>
                            <div class="header-cell cell-center">{{ t('action') }}</div> 
                            <div class="header-cell cell-center">{{ t('creator') }}</div>
                        </div>

                        <div v-for="task in unassignedTasks" :key="task.id" @click="openDetailModal(task, 'task')" class="board-row unassigned-row group cursor-pointer border-l-4 border-orange-300">
                            <div class="row-cell cell-name relative">
                                <span class="truncate font-bold text-slate-700">{{ task.name }}</span>
                            </div>
                            <div class="row-cell cell-center">
                                <div class="status-block bg-white text-slate-400 border border-slate-200">{{ t('pending') }}</div>
                            </div>
                            <div class="row-cell cell-center">
                                <div class="urgency-dot" :class="'u-' + task.urgency"></div>
                                <span class="uppercase text-[10px] font-bold">{{ t(task.urgency) }}</span>
                            </div>
                            <div class="row-cell">
                                <span class="text-xs font-bold text-slate-500 bidi-isolate">{{ task.dueDate || '-' }}</span>
                            </div>
                            <div class="row-cell cell-center">
                                <div class="avatar-unassigned text-[10px] font-bold">?</div>
                            </div>
                            <div class="row-cell cell-center avatar-cell">
                                <img v-if="task.creator" :src="'src/assets/profile/' + (task.creator === 'Dad' ? 'king_profile.png' : 'queen_profile.png')">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <h4 class="text-xs font-black text-slate-400 uppercase tracking-widest mb-4 px-2">{{ t('assignedTasks') }}</h4>
            <div class="board-container">
                <div class="board-grid">
                    <div class="board-header">
                        <div class="header-cell" @click="sortBy('name')" :class="{active: sortKey === 'name'}">
                            {{ t('task') }} <i v-if="sortKey === 'name'" :data-lucide="sortOrder === 1 ? 'chevron-down' : 'chevron-up'" class="w-3 h-3"></i>
                        </div>
                        <div class="header-cell cell-center" @click="sortBy('status')" :class="{active: sortKey === 'status'}">
                            {{ t('status') }} <i v-if="sortKey === 'status'" :data-lucide="sortOrder === 1 ? 'chevron-down' : 'chevron-up'" class="w-3 h-3"></i>
                        </div>
                        <div class="header-cell cell-center" @click="sortBy('urgency')" :class="{active: sortKey === 'urgency'}">
                            {{ t('urgency') }} <i v-if="sortKey === 'urgency'" :data-lucide="sortOrder === 1 ? 'chevron-down' : 'chevron-up'" class="w-3 h-3"></i>
                        </div>
                        <div class="header-cell" @click="sortBy('dueDate')" :class="{active: sortKey === 'dueDate'}">
                            {{ t('dueDate') }} <i v-if="sortKey === 'dueDate'" :data-lucide="sortOrder === 1 ? 'chevron-down' : 'chevron-up'" class="w-3 h-3"></i>
                        </div>
                        <div class="header-cell cell-center" @click="sortBy('owner')" :class="{active: sortKey === 'owner'}">
                            {{ t('owner') }} <i v-if="sortKey === 'owner'" :data-lucide="sortOrder === 1 ? 'chevron-down' : 'chevron-up'" class="w-3 h-3"></i>
                        </div>
                        <div class="header-cell cell-center" @click="sortBy('creator')" :class="{active: sortKey === 'creator'}">
                            {{ t('creator') }} <i v-if="sortKey === 'creator'" :data-lucide="sortOrder === 1 ? 'chevron-down' : 'chevron-up'" class="w-3 h-3"></i>
                        </div>
                    </div>

                    <div v-for="task in sortedAssignedTasks" :key="task.id" @click="openDetailModal(task, 'task')" class="board-row is-task group cursor-pointer">
                        <div class="row-cell cell-name relative">
                            <span class="truncate">{{ task.name }}</span>
                            <div v-if="task.comments.length" class="absolute end-2 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity bg-slate-100 p-1 rounded-full">
                                <i data-lucide="message-square" class="w-3 h-3 text-slate-400"></i>
                            </div>
                        </div>
                        <div class="row-cell cell-center">
                            <div class="status-block" :class="'st-' + task.status.replace(' ','-')">{{ t(task.status) }}</div>
                        </div>
                        <div class="row-cell cell-center">
                            <div class="urgency-dot" :class="'u-' + task.urgency"></div>
                            <span class="uppercase text-[10px] font-bold">{{ t(task.urgency) }}</span>
                        </div>
                        <div class="row-cell">
                            <span class="text-xs font-bold text-slate-500 bidi-isolate">{{ task.dueDate || '-' }}</span>
                        </div>
                        <div class="row-cell cell-center avatar-cell">
                            <img :src="'src/assets/profile/' + (task.owner === 'Dad' ? 'king_profile.png' : 'queen_profile.png')">
                        </div>
                        <div class="row-cell cell-center avatar-cell">
                            <img v-if="task.creator" :src="'src/assets/profile/' + (task.creator === 'Dad' ? 'king_profile.png' : 'queen_profile.png')">
                        </div>
                    </div>
                    <div v-if="sortedAssignedTasks.length === 0" class="col-span-full text-center p-8 text-slate-300 font-bold italic">{{ t('noTasks') }}</div>
                </div>
            </div>

            <div class="mt-12">
                <section-header :title="t('asks')" icon="understandings.png" :has-action="true" @action="openCreateModal('ask')"></section-header>
                
                <h4 class="text-xs font-black text-slate-400 uppercase tracking-widest mb-4 px-2">{{ t('pendingRequests') }}</h4>
                <div class="board-container">
                    <div class="board-grid">
                        <div class="board-header">
                            <div class="header-cell">{{ t('ask') }}</div>
                            <div class="header-cell cell-center">{{ t('status') }}</div>
                            <div class="header-cell cell-center">{{ t('urgency') }}</div>
                            <div class="header-cell">{{ t('dueDate') }}</div>
                            <div class="header-cell cell-center">{{ t('owner') }}</div>
                            <div class="header-cell cell-center">{{ t('creator') }}</div>
                        </div>
                        <div v-for="ask in sortedPendingAsks" :key="ask.id" @click="openDetailModal(ask, 'ask')" class="board-row is-ask cursor-pointer hover:bg-slate-50">
                            <div class="row-cell cell-name"><span class="truncate">{{ ask.name }}</span></div>
                            <div class="row-cell cell-center"><div class="status-block st-pending">{{ t('pending') }}</div></div>
                            <div class="row-cell cell-center"><div class="urgency-dot" :class="'u-' + ask.urgency"></div>{{ t(ask.urgency) }}</div>
                            <div class="row-cell text-xs font-bold text-slate-500 bidi-isolate">{{ ask.dueDate }}</div>
                            <div class="row-cell cell-center avatar-cell"><img :src="'src/assets/profile/' + (ask.owner === 'Dad' ? 'king_profile.png' : 'queen_profile.png')"></div>
                            <div class="row-cell cell-center avatar-cell"><img :src="'src/assets/profile/' + (ask.creator === 'Dad' ? 'king_profile.png' : 'queen_profile.png')"></div>
                        </div>
                    </div>
                </div>

                <h4 v-if="sortedRejectedAsks.length" class="text-xs font-black text-slate-400 uppercase tracking-widest mb-4 px-2 mt-8">{{ t('rejectedRequests') }}</h4>
                <div v-if="sortedRejectedAsks.length" class="bg-white rounded-2xl border border-slate-100 overflow-hidden">
                    <div v-for="ask in sortedRejectedAsks" class="p-4 border-b border-slate-100 flex justify-between items-center opacity-60">
                         <span class="font-bold text-slate-500 line-through">{{ ask.name }}</span>
                         <span class="text-[10px] uppercase font-black bg-slate-100 text-slate-400 px-2 py-1 rounded">{{ t('rejected') }}</span>
                    </div>
                </div>
            </div>

            <transition name="pop">
                <div v-if="isCreateModalOpen" class="modal-overlay" @click.self="isCreateModalOpen = false">
                    <div class="modal-container">
                        <div class="modal-close-btn" @click="isCreateModalOpen = false"><i data-lucide="x" class="w-6 h-6"></i></div>
                        <div class="p-8">
                            <h2 class="text-3xl font-serif text-slate-800 mb-6">{{ t('createNew') }}</h2>
                            
                            <div class="graphic-toggle-container">
                                <div class="graphic-btn" :class="{active: createType === 'task'}" @click="createType = 'task'">
                                    <img src="src/assets/tasks.png" alt="Task">
                                    <span class="graphic-label">{{ t('task') }}</span>
                                </div>
                                <div class="graphic-btn" :class="{active: createType === 'ask'}" @click="createType = 'ask'">
                                    <img src="src/assets/asks.png" alt="Ask">
                                    <span class="graphic-label">{{ t('ask') }}</span>
                                </div>
                            </div>
                            
                            <p class="text-xs text-slate-400 font-bold text-center mb-6 -mt-4">{{ createType === 'task' ? t('taskDesc') : t('askDesc') }}</p>
                            
                            <div class="space-y-4">
                                <input type="text" v-model="newItem.name" :placeholder="t('namePlaceholder')" class="w-full p-4 bg-slate-50 rounded-xl border border-slate-200 outline-none font-bold text-start">
                                <div class="flex gap-4">
                                    <select v-model="newItem.urgency" class="flex-1 p-4 bg-slate-50 rounded-xl border border-slate-200 font-bold text-sm text-slate-600 outline-none text-start">
                                        <option value="low">{{ t('low') }}</option>
                                        <option value="mid">{{ t('mid') }}</option>
                                        <option value="high">{{ t('high') }}</option>
                                        <option value="urgent">{{ t('urgent') }}</option>
                                    </select>
                                    <input type="date" v-model="newItem.dueDate" class="flex-1 p-4 bg-slate-50 rounded-xl border border-slate-200 font-bold text-sm text-slate-600 outline-none text-start">
                                </div>
                                
                                <div v-if="createType === 'task'">
                                    <label class="text-[10px] font-black uppercase text-slate-400 ms-2">{{ t('assignTo') }}</label>
                                    <div class="flex gap-2 mt-1">
                                        <div @click="newItem.owner = 'Dad'" class="btn-assign-option" :class="{active: newItem.owner === 'Dad'}">
                                            <img src="src/assets/profile/king_profile.png" class="w-6 h-6 rounded-full"> <span class="text-xs font-bold">{{ t('Dad') }}</span>
                                        </div>
                                        <div @click="newItem.owner = 'Mom'" class="btn-assign-option" :class="{active: newItem.owner === 'Mom'}">
                                            <img src="src/assets/profile/queen_profile.png" class="w-6 h-6 rounded-full"> <span class="text-xs font-bold">{{ t('Mom') }}</span>
                                        </div>
                                        <div @click="newItem.owner = null" class="btn-assign-option" :class="{active: newItem.owner === null}">
                                            <i data-lucide="help-circle" class="w-4 h-4 text-slate-400"></i> <span class="text-xs font-bold text-slate-400">{{ t('nobody') }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <button @click="confirmCreate" class="huge-action-btn bg-slate-900 text-white w-full mt-8 shadow-xl">
                                {{ t('create') }}
                            </button>
                        </div>
                    </div>
                </div>
            </transition>

            <transition name="pop">
                <div v-if="selectedItem" class="modal-overlay" @click.self="selectedItem = null">
                    <div class="modal-container">
                        <div class="modal-close-btn" @click="selectedItem = null"><i data-lucide="x" class="w-6 h-6"></i></div>
                        <div class="modal-header-banner p-8 pb-4" :class="selectedItemType === 'ask' ? 'bg-teal-600' : 'bg-slate-800'">
                            <div class="flex justify-between items-start">
                                <span class="badge bg-white/20 text-white backdrop-blur-md border border-white/30 px-3 py-1 rounded-full text-xs font-bold">{{ t(selectedItem.urgency) }}</span>
                                <span class="text-xs font-bold text-white/60 uppercase">{{ selectedItemType === 'ask' ? t('ask') : t('task') }}</span>
                            </div>
                            <h2 class="text-2xl text-white mt-4 font-bold leading-tight">{{ selectedItem.name }}</h2>
                        </div>
                        <div class="modal-body !p-6">
                            
                            <div v-if="selectedItemType === 'task' && !selectedItem.owner" class="bg-orange-50 border border-orange-100 p-4 rounded-2xl mb-4">
                                <p class="text-xs font-bold text-orange-800 mb-3 text-center">{{ t('claimTaskMsg') }}</p>
                                <div class="flex gap-2">
                                    <button @click="selectedItem.owner = 'Dad'" class="flex-1 py-3 bg-white border border-slate-200 rounded-xl font-bold text-xs flex items-center justify-center gap-2">
                                        <img src="src/assets/profile/king_profile.png" class="w-4 h-4 rounded-full"> {{ t('Dad') }}
                                    </button>
                                    <button @click="selectedItem.owner = 'Mom'" class="flex-1 py-3 bg-white border border-slate-200 rounded-xl font-bold text-xs flex items-center justify-center gap-2">
                                        <img src="src/assets/profile/queen_profile.png" class="w-4 h-4 rounded-full"> {{ t('Mom') }}
                                    </button>
                                </div>
                            </div>

                            <div class="grid grid-cols-2 gap-4">
                                <div class="bg-slate-50 p-3 rounded-2xl">
                                    <label class="text-[9px] font-black uppercase text-slate-400 block mb-1 text-start">{{ t('status') }}</label>
                                    <select v-model="selectedItem.status" class="bg-transparent font-bold text-sm w-full outline-none text-start" :disabled="selectedItemType === 'ask' && selectedItem.status === 'pending'">
                                        <option value="pending">{{ t('pending') }}</option>
                                        <option value="in progress">{{ t('in progress') }}</option>
                                        <option value="completed">{{ t('completed') }}</option>
                                        <option value="failed">{{ t('failed') }}</option>
                                    </select>
                                </div>
                                <div class="bg-slate-50 p-3 rounded-2xl">
                                    <label class="text-[9px] font-black uppercase text-slate-400 block mb-1 text-start">{{ t('dueDate') }}</label>
                                    <input type="date" v-model="selectedItem.dueDate" class="bg-transparent font-bold text-sm w-full outline-none text-start">
                                </div>
                            </div>
                            <div v-if="selectedItemType === 'ask' && selectedItem.status === 'pending'" class="bg-teal-50 border border-teal-100 p-4 rounded-2xl mt-4">
                                <p class="text-xs font-bold text-teal-800 mb-3 text-center">{{ t('askActionMsg') }}</p>
                                <div class="flex gap-2">
                                    <button @click="handleAskAction('reject')" class="flex-1 py-3 bg-white border border-red-200 text-red-500 rounded-xl font-bold text-xs uppercase">{{ t('reject') }}</button>
                                    <button @click="handleAskAction('accept')" class="flex-1 py-3 bg-teal-600 text-white rounded-xl font-bold text-xs uppercase shadow-md">{{ t('accept') }}</button>
                                </div>
                            </div>
                            <div class="mt-4">
                                <h4 class="text-sm font-bold text-slate-800 border-b border-slate-100 pb-2 text-start">{{ t('activityComments') }}</h4>
                                <div class="chat-thread">
                                    <div v-if="selectedItem.comments.length === 0" class="text-center text-[10px] text-slate-400 italic py-4">{{ t('noComments') }}</div>
                                    <div v-for="c in selectedItem.comments" class="chat-msg">
                                        <img :src="'src/assets/profile/' + (c.author === 'Me' ? 'king_profile.png' : 'queen_profile.png')" class="w-8 h-8 rounded-full border border-slate-200 bg-white">
                                        <div class="msg-bubble" :class="{me: c.author === 'Me'}">
                                            <p class="leading-snug text-start">{{ c.text }}</p>
                                            <span class="text-[9px] opacity-50 block mt-1 bidi-isolate">{{ c.time }}</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="chat-input-area">
                                    <input v-model="newComment" type="text" :placeholder="t('addCommentPlaceholder')" class="chat-input text-sm text-start" @keyup.enter="addComment">
                                    <div @click="addComment" class="chat-send"><i data-lucide="send" class="w-4 h-4"></i></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </transition>

        </main>
        <app-footer :lang="lang"></app-footer>
    </div>

    <script src="components.js"></script>
    <script>
        const { createApp } = Vue;
        
        createApp({
            data() {
                return {
                    lang: 'he', 
                    sortKey: 'urgency', 
                    sortOrder: -1, 

                    tasks: [
                        { id: 1, name: '×œ×ª×§×Ÿ ××ª ×”×‘×¨×– ×‘×ž×˜×‘×—', urgency: 'high', status: 'pending', dueDate: '2026-02-10', owner: 'Dad', creator: 'Mom', comments: [{text: '×“×—×•×£ ×œ×¤× ×™ ×©×™×©×™', author: 'Mom', time: '10:00'}] },
                        { id: 2, name: '×¨×™×©×•× ×œ×›×“×•×¨×’×œ', urgency: 'mid', status: 'completed', dueDate: '2026-01-30', owner: 'Mom', creator: 'Mom', comments: [] },
                        { id: 3, name: '×§× ×™×•×ª ×œ×©×‘×ª', urgency: 'low', status: 'in progress', dueDate: '2026-02-05', owner: 'Dad', creator: 'Dad', comments: [] },
                        { id: 4, name: '×ª×›× ×•×Ÿ ×—×•×¤×©×ª ×§×™×¥', urgency: 'mid', status: 'pending', dueDate: '', owner: null, creator: 'Mom', comments: [] } // Unassigned
                    ],
                    asks: [
                        { id: 101, name: '×”×× ××¤×©×¨ ×œ×§×—×ª ××ª ×§××™ ×‘×©×œ×™×©×™?', urgency: 'mid', status: 'pending', dueDate: '2026-02-12', owner: 'Mom', creator: 'Dad', comments: [] },
                        { id: 102, name: '×”×—×œ×¤×ª ×¡×•×¤"×©?', urgency: 'low', status: 'rejected', dueDate: '2026-02-20', owner: 'Dad', creator: 'Mom', comments: [{text: '×œ× ×™×›×•×œ, ×™×© ×¢×‘×•×“×”', author: 'Dad', time: '09:00'}] }
                    ],

                    isCreateModalOpen: false,
                    createType: 'task', 
                    selectedItem: null,
                    selectedItemType: null,
                    newItem: { name: '', urgency: 'mid', dueDate: '', owner: 'Dad' },
                    newComment: '',

                    translations: {
                        en: {
                            management: 'Management', activeTasks: 'Active Tasks', tasks: 'Tasks', asks: 'Asks',
                            pendingRequests: 'Pending Requests', rejectedRequests: 'Rejected Requests', noTasks: 'No active tasks.',
                            task: 'Task', ask: 'Ask', createNew: 'Create New', taskDesc: 'A job to be done by someone.', askDesc: 'A request for the other parent.',
                            namePlaceholder: 'Task Name...', urgency: 'Urgency', assignTo: 'Assign', create: 'Create',
                            pending: 'Pending', 'in progress': 'In Progress', completed: 'Completed', failed: 'Failed', rejected: 'Rejected',
                            owner: 'Owner', creator: 'Creator', waitingFor: 'Waiting', from: 'From',
                            askActionMsg: 'Accept request?', accept: 'Accept', reject: 'Reject',
                            activityComments: 'Activity', noComments: 'No comments.', addCommentPlaceholder: 'Note...',
                            low: 'Low', mid: 'Mid', high: 'High', urgent: 'Urgent', status: 'Status', dueDate: 'Due',
                            Dad: 'Dad', Mom: 'Mom', nobody: 'Unassigned', assignedTasks: 'Assigned Tasks', 
                            waitingForOwner: 'Waiting for Owner', action: 'Action', claimTaskMsg: 'Task is unassigned. Who takes it?'
                        },
                        he: {
                            management: '× ×™×”×•×œ ×ž×©×™×ž×•×ª', activeTasks: '×ž×©×™×ž×•×ª ×¤×¢×™×œ×•×ª', tasks: '×ž×©×™×ž×•×ª ×©×•×˜×¤×•×ª', asks: '×‘×§×©×•×ª ×•×ª×™××•×ž×™×',
                            pendingRequests: '×‘×§×©×•×ª ×ž×ž×ª×™× ×•×ª', rejectedRequests: '×‘×§×©×•×ª ×©× ×“×—×•', noTasks: '××™×Ÿ ×ž×©×™×ž×•×ª ×¤×¢×™×œ×•×ª.',
                            task: '×ž×©×™×ž×”', ask: '×‘×§×©×”', createNew: '×™×¦×™×¨×”', taskDesc: '×ž×©×”×• ×©×¦×¨×™×š ×œ×¢×©×•×ª.', askDesc: '×‘×§×©×” ×ž×”×¤×¨×˜× ×¨ ×”×©× ×™.',
                            namePlaceholder: '×©× ×”×ž×©×™×ž×”...', urgency: '×“×—×™×¤×•×ª', assignTo: '×ž×©×•×™×š ×œ', create: '×¦×•×¨',
                            pending: '×œ×‘×™×¦×•×¢', 'in progress': '×‘×ª×”×œ×™×š', completed: '×”×•×©×œ×', failed: '× ×›×©×œ', rejected: '× ×“×—×”',
                            owner: '××—×¨××™', creator: '× ×•×¦×¨ ×¢×´×™', waitingFor: '×ž×ž×ª×™×Ÿ', from: '×ž××ª',
                            askActionMsg: '×œ××©×¨ ××ª ×”×‘×§×©×”?', accept: '××™×©×•×¨', reject: '×“×—×™×™×”',
                            activityComments: '×¤×¢×™×œ×•×ª ×•×ª×’×•×‘×•×ª', noComments: '××™×Ÿ ×ª×’×•×‘×•×ª ×¢×“×™×™×Ÿ.', addCommentPlaceholder: '×”×•×¡×£ ×”×¢×¨×”...',
                            low: '× ×ž×•×š', mid: '×¨×’×™×œ', high: '×’×‘×•×”', urgent: '×“×—×•×£!', status: '×¡×˜×˜×•×¡', dueDate: '×™×¢×“',
                            Dad: '××‘×', Mom: '××ž×', nobody: '×˜×¨× ×©×•×™×š', assignedTasks: '×ž×©×™×ž×•×ª ×‘×˜×™×¤×•×œ', 
                            waitingForOwner: '×ž×ž×ª×™×Ÿ ×œ××—×¨××™', action: '×¤×¢×•×œ×”', claimTaskMsg: '×”×ž×©×™×ž×” ×œ×œ× ×©×™×•×š. ×ž×™ ×œ×•×§×—?'
                        }
                    }
                }
            },
            
            // --- WATCHER FOR LANGUAGE TOGGLE ---
            watch: {
                lang: {
                    immediate: true,
                    handler(newLang) {
                        document.body.className = newLang === 'en' ? 'lang-en' : 'lang-he';
                        document.documentElement.dir = newLang === 'en' ? 'ltr' : 'rtl';
                        this.$nextTick(() => lucide.createIcons());
                    }
                }
            },

            computed: {
                unassignedTasks() { return this.tasks.filter(t => !t.owner); },
                assignedTasks() { return this.tasks.filter(t => t.owner); },
                
                sortedAssignedTasks() { return this.sortList(this.assignedTasks); },
                sortedPendingAsks() { return this.sortList(this.asks.filter(a => a.status === 'pending')); },
                sortedRejectedAsks() { return this.asks.filter(a => a.status === 'rejected'); }
            },
            methods: {
                t(key) { return this.translations[this.lang][key] || key; },
                toggleLang() { this.lang = this.lang === 'en' ? 'he' : 'en'; },
                
                sortBy(key) {
                    if (this.sortKey === key) {
                        this.sortOrder = this.sortOrder * -1; 
                    } else {
                        this.sortKey = key;
                        this.sortOrder = 1;
                    }
                    this.$nextTick(() => lucide.createIcons());
                },
                sortList(list) {
                    return [...list].sort((a, b) => {
                        let valA = a[this.sortKey];
                        let valB = b[this.sortKey];

                        if (this.sortKey === 'urgency') {
                            const weights = { urgent: 4, high: 3, mid: 2, low: 1 };
                            valA = weights[valA] || 0;
                            valB = weights[valB] || 0;
                        }
                        if (this.sortKey === 'status') {
                            const weights = { pending: 1, 'in progress': 2, completed: 3, failed: 4 };
                            valA = weights[valA] || 0;
                            valB = weights[valB] || 0;
                        }
                        if (!valA) valA = '';
                        if (!valB) valB = '';

                        if (valA < valB) return -1 * this.sortOrder;
                        if (valA > valB) return 1 * this.sortOrder;
                        return 0;
                    });
                },

                openCreateModal(type) {
                    this.createType = type || 'task';
                    this.newItem = { name: '', urgency: 'mid', dueDate: '', owner: 'Dad' };
                    this.isCreateModalOpen = true;
                },
                
                confirmCreate() {
                    if(!this.newItem.name) return;
                    
                    const item = {
                        id: Date.now(),
                        name: this.newItem.name,
                        urgency: this.newItem.urgency,
                        status: 'pending',
                        dueDate: this.newItem.dueDate,
                        comments: [],
                        creator: 'Me' 
                    };

                    if(this.createType === 'task') {
                        item.owner = this.newItem.owner; 
                        this.tasks.unshift(item);
                    } else {
                        item.owner = 'Mom'; 
                        item.creator = 'Dad';
                        this.asks.unshift(item);
                    }
                    this.isCreateModalOpen = false;
                    this.$nextTick(() => lucide.createIcons());
                },

                openDetailModal(item, type) {
                    this.selectedItem = item;
                    this.selectedItemType = type;
                    this.$nextTick(() => lucide.createIcons());
                },

                addComment() {
                    if(!this.newComment.trim()) return;
                    this.selectedItem.comments.push({
                        text: this.newComment,
                        author: 'Me',
                        time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
                    });
                    this.newComment = '';
                },

                handleAskAction(action) {
                    if(action === 'reject') {
                        this.selectedItem.status = 'rejected';
                        this.selectedItem.comments.push({text: '×‘×§×©×” × ×“×—×ª×”', author: 'System', time: 'Now'});
                    } else {
                        const taskCopy = JSON.parse(JSON.stringify(this.selectedItem));
                        taskCopy.status = 'pending'; 
                        this.asks = this.asks.filter(a => a.id !== this.selectedItem.id);
                        this.tasks.unshift(taskCopy);
                        this.selectedItem = null; 
                    }
                }
            },
            mounted() { lucide.createIcons(); }
        }).component('app-header', AppHeader)
          .component('app-footer', AppFooter)
          .component('section-header', SectionHeader)
          .component('ai-chat', AiChat)
          .mount('#app');
    </script>
</body>
</html>